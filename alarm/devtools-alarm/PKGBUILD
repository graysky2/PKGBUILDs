# Maintainer: Levente Polyak <anthraxx[at]archlinux[dot]org>
# Maintainer: Pierre Schmitz <pierre@archlinux.de>

# ALARM: Kevin Mihelich <kevin@archlinuxarm.org>
#  - patches to fix issues with how we use the tools

pkgname=devtools-alarm
_pkgname=devtools
pkgver=1.2.0
pkgrel=1
pkgdesc='Tools for Arch Linux ARM package maintainers graysky mods'
arch=('any')
license=('GPL')
url='https://gitlab.archlinux.org/archlinux/devtools'
conflicts=('devtools')
provides=('devtools')
depends=(
  arch-install-scripts
  awk
  bash
  binutils
  coreutils
  curl
  diffutils
  expac
  fakeroot
  findutils
  grep
  jq
  openssh
  parallel
  rsync
  sed
  util-linux
  breezy
  git
  mercurial
  subversion
)
makedepends=(
  asciidoctor
)
optdepends=(
  'btrfs-progs: btrfs support'
  'bat: pretty printing for pkgctl search'
  'nvchecker: pkgctl version subcommand'
)
source=(https://gitlab.archlinux.org/archlinux/$_pkgname/-/archive/v$pkgver/$_pkgname-v$pkgver.tar.gz
#  https://gitlab.archlinux.org/archlinux/$_pkgname/-/archive/v$pkgver/$_pkgname-v$pkgver.tar.gz.sig
  0001-makechrootpkg-cache-dir.patch
  0002-arch-nspawn-keep-mirrorlist.patch
  0003-makechrootpkg-distcc.patch
  0004-arch-nspawn-arm-fix.patch
  0005-makechrootpkg-no-default-logging.patch
  0006-archbuild-no-setarch.patch
  0007-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACKAGER.patch
  0008-makechrootpkg-gotmpdir.patch
  0009-arm-helpers.patch
  0010-Revert-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACK.patch
  0011-makechrootpkg-don-t-delete-PACKAGER-and-fix-MAKEFLAG.patch
  0012-Revert-makechrootpkg-no-default-logging.patch
  0013-arch-nspawn-fix-setarch-for-armv7h.patch
)
validpgpkeys=(
  '4AA4767BBC9C4B1D18AE28B77F2D434B9741E8AC' # Pierre Schmitz <pierre@archlinux.org>
  '86CFFCA918CF3AF47147588051E8B148A9999C34' # Evangelos Foutras <foutrelis@archlinux.org>
  '8FC15A064950A99DD1BD14DD39E4B877E62EB915' # Sven-Hendrik Haase <svenstaro@archlinux.org>
  'A2FF3A36AAA56654109064AB19802F8B0D70FC30' # Jan Alexander Steffens (heftig) <heftig@archlinux.org>
  'B81B051F2D7FC867AAFF35A58DBD63B82072D77A' # SÃ©bastien Luttringer <seblu@archlinux.org>
  '6645B0A8C7005E78DB1D7864F99FFE0FEAE999BD' # Allan McRae (Developer) <allan@archlinux.org>
  'E240B57E2C4630BA768E2F26FC1B547C8D8172C8' # Levente Polyak <anthraxx@archlinux.org>
)
sha256sums=('053702dc8166be5b5ec6b142907482860eee114c71b98fcd4d4bab8040c13b24'
            '3343c0ff39d06c3c690112493150466228e6e8af91a05c8536204cee39635f15'
            '34315b23ee1dee353c540a38c456275d41cbcddae6a26f23665b2084be93d304'
            '025d2a28044bb8332dbc7ce189ee44c20e35f68d14d0c870d112918d58924f86'
            '3eebcd726a5aa432235839d1b98fe300961003a9f8f2054c1794b9039a152522'
            'b51ce8a3eaafda42bcd893709b377c422f2e98f5984803ed34a9a181fa7b4edd'
            '3e93d0586991a87b3d543e1589aa327ee5cbe4b5a74aefbe2fba49e152258695'
            'b70fba09db3b81478b615b23a58938da580529893997149293b70f11e290a65e'
            '457eb6191d46e947b2c6432a513b74d7b3f74d690dcb50617a82abf806e219ef'
            'ec23054050861d0d90ac130085d0a46ef7ae75ec889f0e27a8a436ea92392b39'
            '991427a014410783bf4b3a5fd6a093c6382d1c953dda78b902e0194dadca582f'
            '4ce3f0b1121795c5cc8fb5cc66c3c89ab7b35da62934d270a3f4b214a84c7338'
            'b2084ea5cf7943c1eaada755638a1061ee37c749b625c2490c81c439637625fc'
            'c225a4d1b005542aa3468907cce875ca50d9d93d533dbd61e9af35e4681fb5c6')
b2sums=('abdfdaba79ab77196a3b5adc44f4f19a9e27bbb1200431f0a11da2c0ecba7279ca76afea5147e2cdbf73d918c4ff77cb498f34eac25d3cae31c336845e6cfad4'
        '420da3a6f31cd0ed56e0397121aa9a396a65b06e3c58d30adbdfaed0c60397dd8819d67b48ad78020b478a8499250fe85c09b14445048465a8c73744eafb6607'
        'a14e267dc1803f6a41cd1a2278e5965c06140002db929799d3282b04e9e4d11afbb763e756d20849a6bd08852a38db08665ce0e1c2232d0a018f7a09f72387a1'
        'b486baf3ba28ad0a1a8f0195001056bcc326ecf6794967a3770c8cd82ef0bd150ba8974ad96737d9f556cb3797de3c9160454e1283bdc8af1eaa8baaddb5423b'
        '5a71c00cfa0f05154264544840efda36b236f3598683d2b421825def0094103d1ecad9b0a80ad664c3ebb364e3ef4a46b273f8f3ae253fdc74b6817a76588cba'
        '2f8d5aa43070963fa990801ddcd83f0ea15174f307a7cd63aee9fa94a48c4aa1cec52bbfa19ccba70a4ad8b10f9b5cf61355d59840076e8386f04a2ff55dc90c'
        'e62b614a50216a2c8ff37c0ab5029d08d74df33338aeb74aab42742e2bda3e1789ceca478a0e26fa16bbfcbb9999602ca322c1d8734b5b8cd0b22b76c12f86f6'
        '8fbb1398d283b3edc353b155f541789d2dc5e0fc84cffce4e24e8056b4e9cfac408d472a6ef6d8aa0d092fa396c36173d3018739965470ecc5be136de82f9090'
        '15ad1f103b92cf7ba6286966f2313cbb4b746b5b3e899ee5af547c96e86944f4c59456c6336bb8f4749f3fc8c9d4b788e1122c21890cece4f3bf6da95bd76332'
        '7044a64f1784ce0c468235194fc05b9dbeb8568182584eb45bf681d5c7226dc80f75095d1832c3d0845c451aa31169395c7d3a3410730ef6eb97d3491a871944'
        '2e30484fe2c5bfb541e1b479dec04108b6300aaead45e6b5f4769fb0ade3ff3a98a488b08eadaca1319991f8e8667779d91dd7b74cb3ed835768095b2f87e720'
        'f086729e9ac1fd44d38ef04a8536894306609f1e034994a8e6d8e8d8ecbd34903dd2ab8e6f4e5fcce2836323dc7211b55f12f6ac77610368fcd4863acceeacca'
        '393446788cc1eb5bd10b5001784543c463c4836d8a0985f93bec95fc1e16cdf0d2a5c923623cb1a473a1a9d705b7058e1ec93c20b91365c5edf0268a6a6a41cd'
        '511d9e160ee12644d6b80be9248eafb65fda689692a9a2586627f8bdbfeb857c6b545cfae87666734ab1705127bb8e47b7f72539f0b09cccc7b6b3097a45005c')

prepare() {
  cd "${_pkgname}-v${pkgver}"
  for src in "${source[@]}"; do
    src="${src%%::*}"
    src="${src##*/}"
    [[ $src = 0*.patch ]] || continue
    echo "Applying patch $src..."
    patch -Np1 < "../$src"
  done
}

build() {
  cd ${_pkgname}-v${pkgver}
  make BUILDTOOLVER="${pkgver}-${pkgrel}-${arch}" PREFIX=/usr
}

package() {
  cd ${_pkgname}-v${pkgver}
  make PREFIX=/usr DESTDIR="${pkgdir}" install
}

# vim: ts=2 sw=2 et:
