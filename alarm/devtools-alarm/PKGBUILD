# Maintainer: Levente Polyak <anthraxx[at]archlinux[dot]org>
# Maintainer: Pierre Schmitz <pierre@archlinux.de>

# ALARM: Kevin Mihelich <kevin@archlinuxarm.org>
#  - patches to fix issues with how we use the tools

pkgname=devtools-alarm
_pkgname=devtools
pkgver=1.2.1
pkgrel=1
pkgdesc='Tools for Arch Linux ARM package maintainers graysky mods'
arch=('any')
license=('GPL')
url='https://gitlab.archlinux.org/archlinux/devtools'
conflicts=('devtools')
provides=('devtools')
depends=(
  arch-install-scripts
  awk
  bash
  binutils
  coreutils
  curl
  diffutils
  expac
  fakeroot
  findutils
  grep
  jq
  openssh
  parallel
  rsync
  sed
  util-linux
  breezy
  git
  mercurial
  subversion
)
makedepends=(
  asciidoctor
)
optdepends=(
  'btrfs-progs: btrfs support'
  'bat: pretty printing for pkgctl search'
  'nvchecker: pkgctl version subcommand'
)
source=(https://gitlab.archlinux.org/archlinux/$_pkgname/-/archive/v$pkgver/$_pkgname-v$pkgver.tar.gz
#  https://gitlab.archlinux.org/archlinux/$_pkgname/-/archive/v$pkgver/$_pkgname-v$pkgver.tar.gz.sig
  0001-makechrootpkg-cache-dir.patch
  0002-arch-nspawn-keep-mirrorlist.patch
  0003-makechrootpkg-distcc.patch
  0004-arch-nspawn-arm-fix.patch
  0005-makechrootpkg-no-default-logging.patch
  0006-archbuild-no-setarch.patch
  0007-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACKAGER.patch
  0008-makechrootpkg-gotmpdir.patch
  0009-arm-helpers.patch
  0010-Revert-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACK.patch
  0011-makechrootpkg-don-t-delete-PACKAGER-and-fix-MAKEFLAG.patch
  0012-Revert-makechrootpkg-no-default-logging.patch
  0013-arch-nspawn-fix-setarch-for-armv7h.patch
)
validpgpkeys=(
  '4AA4767BBC9C4B1D18AE28B77F2D434B9741E8AC' # Pierre Schmitz <pierre@archlinux.org>
  '86CFFCA918CF3AF47147588051E8B148A9999C34' # Evangelos Foutras <foutrelis@archlinux.org>
  '8FC15A064950A99DD1BD14DD39E4B877E62EB915' # Sven-Hendrik Haase <svenstaro@archlinux.org>
  'A2FF3A36AAA56654109064AB19802F8B0D70FC30' # Jan Alexander Steffens (heftig) <heftig@archlinux.org>
  'B81B051F2D7FC867AAFF35A58DBD63B82072D77A' # SÃ©bastien Luttringer <seblu@archlinux.org>
  '6645B0A8C7005E78DB1D7864F99FFE0FEAE999BD' # Allan McRae (Developer) <allan@archlinux.org>
  'E240B57E2C4630BA768E2F26FC1B547C8D8172C8' # Levente Polyak <anthraxx@archlinux.org>
)
sha256sums=('0683a29268b4e47650b403916fdfd65784556632bd0dca59f1429f2af28c9ffb'
            'bb5838bf9356c42335ea26f3986c1ae3a547f1da35e8575b942792e8accf5f53'
            'c2ba4a933fc4e4855254f72a695c3a316d7e479f6b1e6b397759789b060db7f3'
            '71f6fb547bbf7d5fa01805bb529279a3b1ea82e5e8d0be42a62b6d0ea51d48da'
            '2a14a3e38984d216234f37954e8119a0cd0db14f90e084ab968171e34ad3c564'
            '83f13493951c5e4fe86064152574730ac6b2b08fda1445634616c7c02ede5add'
            '527c1da8f6b8762b5f48f9a73b9c7518ba73a8104a927a26e9d4f38b81067ea3'
            'f79de899a83189147e058e1e89f0d4508bc82b2d27af20fff6c1b60a1ad94bb6'
            'ad7f39a3a6ce8a0b9d10887257d7be0b8c413069fb06efe392f828792a03c035'
            '3e986c5ae4787f0b7238516857115c617bfbab92eb3b97fcb75afd3c5602a600'
            '781fe0c8297e33e3ecd798d0699972335c6c92c070b0df755401f804e8ac114b'
            '7a355bad065351b1bc77a782210ac96110cafada2e3a426a326ab8f85047e00c'
            'f7946a5efee7800aa9dec7fc55bb7089cb92e55a687e27ede767b2b67b4a2b0f'
            'd554599ac2d5369b09af34dcc653faabd2e78dcb7956e4e41e8d018e39970ced')
b2sums=('5bb7d5a1071ce28d54f0a4ec1feab9bdad3a4929e926bf7b4ef87463dd1c4e815824b982f01159ddd546dd8a5c78aa353c8376c3c3cb6424e84c8cdfe08626d7'
        '34921580bb90a2270680351037e014b758ca6ac553b4eb19eb43ab8574a230a0683d241cc2a8976fbb0ecca1ee0f0687ae2946e94bfe5f5337bad5b2b1012196'
        '125721f5d43e1727b63114fb3f25cbafc1d02d7bbe8b41b0862ff2b55414b001fe52e9e35767250d232e0c135e9823d6e18438a45798317f95610d1121b95e62'
        '81d8df3991ac1b9f1de37e82db3338bdf51057aacd6f7fb6c7b9c0116f1989664930e19254bac5859db32c616c931d66d18445b8a045c40daf187fb2d24213eb'
        '4e4aa62224bbdf678a113b0e945a9f03ea6548246d61c0c9e97b5b86961d2dcd0eb325fb0cdf2c2f387e0427649aaec2efe8dd5c702e92fd6bfb30bb4db0d868'
        '31fe636b253b26701fc3f7d285420c2103090cecb08b8a45482f49a930eeb7a80c3769f2038894f003e0bd2e8746b4427e5e9a4b124746a171d57b64a5de914c'
        '4366769c320dc948649b9299a3f27be3e4943e3b7d46c4f6ad3d13cf834e6a0af779913a8ae91d19a5ca9269dd6a7e317aca7cfa07d61f5faaeb848dd23f8bb9'
        'fa8e79fe3cba3d1160d40e1387b45bccca99c68dd601117ab345b8d78f2d1aadb18cb56bbef3fd5e3b49d1bd655dc138b80a822c393cb4d391ca68fb17a2c3f8'
        '57cccd00ddc7309c8d17b04afe51028c99ea2443bbbd124dc3bfc642d9f9a706da6c9bdff5dcb72b9938c21e957c76f983b0bfec05d05385e454f6b87f76152a'
        '91141e47c21cc1065ade924a3421b7854b46b372143171048df0f1c2b028d56d9000b8ed4689327e45b8e4a85f125efc8ddb5f3ba1cd713e82d740b6433287f0'
        'a7dcca7a28edf8ed0d17bf0211796a6fd24c7589ae7027851f3c62cbc5f7fdb8b877da3feafb16c794598a3b532f63e750ea6cf86069d92487b224ead94195cd'
        'c3e6432d59368d9cefd40c543fb4f39e74c07e9522b9b156a66c8713daa87b08a840b90ed1adac4e284eb4d00d5c93f1da928c97adc01d23e57c6c9b743f2d28'
        'c95c468027ed859a68707eb70c1e89aae89a51a7573fb9f0e4ac9c6a929efdb5c18bcc89e753f6fe39c6257f889574ea5247d070215e9cb9bb4b1d3818990574'
        'dd222854eb1dab21a2beb5c5cb26d427693632d2a0989c4fa33153644304bdc0226aed7065cc032eb0490d6c1e0dc0b142d887e5442decad056111b5d4fb56b8')

prepare() {
  cd "${_pkgname}-v${pkgver}"
  for src in "${source[@]}"; do
    src="${src%%::*}"
    src="${src##*/}"
    [[ $src = 0*.patch ]] || continue
    echo "Applying patch $src..."
    patch -Np1 < "../$src"
  done
}

build() {
  cd ${_pkgname}-v${pkgver}
  make BUILDTOOLVER="${pkgver}-${pkgrel}-${arch}" PREFIX=/usr
}

package() {
  cd ${_pkgname}-v${pkgver}
  make PREFIX=/usr DESTDIR="${pkgdir}" install
}

# vim: ts=2 sw=2 et:
