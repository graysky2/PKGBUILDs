From b96628d8a2870334c7e4a6e2e9ba5c9b3201d69a Mon Sep 17 00:00:00 2001
From: graysky <therealgraysky@proton.me>
Date: Sat, 20 Aug 2022 16:40:01 -0400
Subject: [PATCH 11/12] makechrootpkg: don't delete PACKAGER and fix MAKEFLAGS

Keep MAKEFLAGS so it can prefix a call to makechrootpkg.
MAKEFLAGS= must not be defined in $BUILDROOT/etc/makepkg.conf for this to work.
See: https://bugs.archlinux.org/task/64938
---
 src/makechrootpkg.in | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/src/makechrootpkg.in b/src/makechrootpkg.in
index 09b0432..b770242 100644
--- a/src/makechrootpkg.in
+++ b/src/makechrootpkg.in
@@ -170,9 +170,8 @@ prepare_chroot() {
 
 	$install -d "$copydir"/{build,startdir,{pkg,srcpkg,src,log}dest}
 
-  sed -e '/^MAKEFLAGS=/d' -e '/^PACKAGER=/d' -i "$copydir/etc/makepkg.conf"
   for x in BUILDDIR=/build PKGDEST=/pkgdest SRCPKGDEST=/srcpkgdest SRCDEST=/srcdest LOGDEST=/logdest \
-    "MAKEFLAGS='${MAKEFLAGS:-}'" "PACKAGER='${PACKAGER:-}'"
+    "MAKEFLAGS='${MAKEFLAGS:-}'"
 	do
 		grep -q "^$x" "$copydir/etc/makepkg.conf" && continue
 		echo "$x" >>"$copydir/etc/makepkg.conf"
-- 
2.42.0

