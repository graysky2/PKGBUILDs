# Maintainer: Levente Polyak <anthraxx[at]archlinux[dot]org>
# Maintainer: Pierre Schmitz <pierre@archlinux.de>

# ALARM: Kevin Mihelich <kevin@archlinuxarm.org>
#  - patches to fix issues with how we use the tools

pkgname=devtools-alarm
_pkgname=devtools
pkgver=20220621
pkgrel=1
pkgdesc='Tools for Arch Linux ARM package maintainers graysky mods'
arch=('any')
license=('GPL')
url='https://gitlab.archlinux.org/archlinux/devtools'
conflicts=('devtools')
provides=('devtools')
depends=('bash' 'openssh' 'subversion' 'rsync' 'arch-install-scripts'
         'git' 'bzr' 'mercurial' 'diffutils' 'util-linux' 'awk')
makedepends=('asciidoc')
optdepends=('btrfs-progs: btrfs support')
source=(${url}/uploads/8217baae0afcdb540bde9f5b030f05a9/devtools-${pkgver}.tar.gz
        ${url}/uploads/8570458d06b07d5a3ff8d30a1fc392d4/devtools-${pkgver}.tar.gz.sig
        '0001-makechrootpkg-cache-dir.patch'
        '0002-arch-nspawn-keep-mirrorlist.patch'
        '0003-makechrootpkg-distcc.patch'
        '0004-arch-nspawn-arm-fix.patch'
        '0005-makechrootpkg-no-default-logging.patch'
        '0006-archbuild-no-setarch.patch'
        '0007-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACKAGER.patch'
        '0008-makechrootpkg-gotmpdir.patch'
        0009-Revert-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACK.patch
        0010-makechrootpkg-don-t-delete-PACKAGER-and-fix-MAKEFLAG.patch
        0011-Revert-makechrootpkg-no-default-logging.patch
        )
validpgpkeys=(
  '4AA4767BBC9C4B1D18AE28B77F2D434B9741E8AC' # Pierre Schmitz <pierre@archlinux.org>
  '86CFFCA918CF3AF47147588051E8B148A9999C34' # Evangelos Foutras <foutrelis@archlinux.org>
  '8FC15A064950A99DD1BD14DD39E4B877E62EB915' # Sven-Hendrik Haase <svenstaro@archlinux.org>
  'A2FF3A36AAA56654109064AB19802F8B0D70FC30' # Jan Alexander Steffens (heftig) <heftig@archlinux.org>
  'B81B051F2D7FC867AAFF35A58DBD63B82072D77A' # SÃ©bastien Luttringer <seblu@archlinux.org>
  '6645B0A8C7005E78DB1D7864F99FFE0FEAE999BD' # Allan McRae (Developer) <allan@archlinux.org>
  'E240B57E2C4630BA768E2F26FC1B547C8D8172C8' # Levente Polyak <anthraxx@archlinux.org>
)
sha256sums=('0938d41b4bc469e62d86d2a287612a090640f6eebde92137b8bd7727b89e95dd'
            'SKIP'
            '618bda0dad5337f8e1500832a5f255300802e94ada7711907dc47f2569e9f519'
            'b0e43fb242096127aba846d9f597bb31c34a5de636e4bd473a2fdf63d9a89976'
            'd6ef2ff23accb15b554cf54d75ca5a55ff67400c0852d2646a3bd5533d1ed70d'
            '9d9e6949882d89dfb1cc8dc833dbb1f4bb4a0d1be50439a3ae27e78820df3763'
            '1d6f17cc9c77690bdd007e276da52a6acf54b52dbe081ce6c6767a3fa1b5b113'
            '2f68d22a0c04fe6a47266a9e2b68b90b092be6ab5888686609fd85b19ed8c5b3'
            '3b6d1b20d5145d13c8d8b8fd4a6555034579067dcb768ea574e29bfb7101fb09'
            '1162044b55ebf6cbec81da94dd1d85e48657311f03e322f3a17dc22e060b54a1'
            '535613ff680af104be96410ac1e99e3a2ffd2d36d5dff0eeaf2782f4bba4e7ea'
            '983cb01e166ea9869486d4784fcff9001e2f73de7bbb6f7688c9a1586133e636'
            '731c617b91c40d5f753e3940f879aa07fb523f448cec68acc1b2f8561d1a7ef1')
b2sums=('007f62b6cb3f06904fcafec4869a43136643bd364a7f0f314c792c08fbdafafaf8a268f8a372f78402deaa1f87bfc3f2fc7099f78742c6776d4ac49fe4884d58'
        'SKIP'
        '1d1a9c5ea3279dc0bae47265f5068b6fae2de63c6f81cba0a713b36b84ddb60f5e982f5e3acc21dd2316fbf9b756036091c51545f1fa1a623628e72bbe2b717d'
        'ed5c5c92caf67e13ba06dae6c73d775786eaf640fbc06cb70faf0d0f088f9c092fda2be76d767b20d96a10c670818d3bf7ebbc96467418234add7b88f308dc34'
        '4406f49a909b7101e2950ae6ee0484f6e71da41396d2a6884b0df996d06fc94026624cc2e87f237b5ffb017414f6c7cd34ef881234654763c4e194c9a1460db2'
        '4d8c095d07218f1f7d252e1a2cb0f01cf4c2fd856a9dfaa06006e51a32107b53e3ec0ce19606ed5f2c9888863b08330dd4ce2f95d0df8c585edcffe85dd4a094'
        '8a672b6debaac19baf2189acbb72b027860bf6d16306feb8d93f48c5ef32f5d073a618a04c65ed645f47d46332b0cead282b63950b2dab0efcab23b38cc61dc8'
        'd796e4c6c8522889d803fe6ee6f52cec548e34db28bb2aeb7a62d7d3cb5e357692d83292d6b51045bc799e3f1ce985583b905b0dd9d2b22cfbdd430e6a60f5c8'
        '9003b89871dcb20f36991a28a3095762191ed9101283504a3a986e38d1b9f207a5db6d7500f047ee40dea6fe17a21a56a94aba5816ad686490d7534cdf77b715'
        '66b23af5326e0031657f2499ae004cf922b71623798f885d7c777fa1cf44172db2ae05d7128bb932df3f3f2a7c47b418d428687c9f149c2d0b487ec6bd68571e'
        '31e466957a007b73cd29d01ed27c010f96a1d554a52298b02ed562e919dca10dc953194939191013598d61969b5fd11872e5b7febd368d494bb471bb58d20a9f'
        '52647c4649bb71ea73b96accb4439d684fd5db4596a1e273af0fd46d9ccaf65043ce2079701bde52c6e6d07efd19a0c740a680c58cf25a1909f675310eddce49'
        'e27ecf3d60f5b65c4c60836a168d9fa74881caf30f147286689f88de66591cccd2c9078a4372b687a7dea737615a5b77e4dd9b314f4948158739e5ae6ec82edd')

prepare() {
  cd "${_pkgname}-${pkgver}"
  for src in "${source[@]}"; do
    src="${src%%::*}"
    src="${src##*/}"
    [[ $src = 0*.patch ]] || continue
    echo "Applying patch $src..."
    patch -Np1 < "../$src"
  done
}

build() {
  cd ${_pkgname}-${pkgver}
  make BUILDTOOLVER="${pkgver}-${pkgrel}-${arch}" PREFIX=/usr
}

package() {
  cd ${_pkgname}-${pkgver}
  make PREFIX=/usr DESTDIR="${pkgdir}" install
}

# vim: ts=2 sw=2 et:
