# Maintainer: Levente Polyak <anthraxx[at]archlinux[dot]org>
# Maintainer: Pierre Schmitz <pierre@archlinux.de>

# ALARM: Kevin Mihelich <kevin@archlinuxarm.org>
#  - patches to fix issues with how we use the tools

pkgname=devtools-alarm
_pkgname=devtools
pkgver=1.0.4
pkgrel=1
pkgdesc='Tools for Arch Linux ARM package maintainers graysky mods'
arch=('any')
license=('GPL')
url='https://gitlab.archlinux.org/archlinux/devtools'
conflicts=('devtools')
provides=('devtools')
depends=('bash' 'openssh' 'subversion' 'rsync' 'arch-install-scripts'
         'git' 'bzr' 'mercurial' 'diffutils' 'util-linux' 'awk')
makedepends=('asciidoc')
optdepends=('btrfs-progs: btrfs support')
source=(https://gitlab.archlinux.org/archlinux/$_pkgname/-/archive/v$pkgver/$_pkgname-v$pkgver.tar.gz
#  https://gitlab.archlinux.org/archlinux/$_pkgname/-/archive/v$pkgver/$_pkgname-v$pkgver.tar.gz.sig
  0001-makechrootpkg-cache-dir.patch
  0002-arch-nspawn-keep-mirrorlist.patch
  0003-makechrootpkg-distcc.patch
  0004-arch-nspawn-arm-fix.patch
  0005-makechrootpkg-no-default-logging.patch
  0006-archbuild-no-setarch.patch
  0007-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACKAGER.patch
  0008-makechrootpkg-gotmpdir.patch
  0009-arm-helpers.patch
  0010-Revert-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACK.patch
  0011-makechrootpkg-don-t-delete-PACKAGER-and-fix-MAKEFLAG.patch
  0012-Revert-makechrootpkg-no-default-logging.patch
  0013-arch-nspawn-fix-setarch-for-armv7h.patch
)
validpgpkeys=(
  '4AA4767BBC9C4B1D18AE28B77F2D434B9741E8AC' # Pierre Schmitz <pierre@archlinux.org>
  '86CFFCA918CF3AF47147588051E8B148A9999C34' # Evangelos Foutras <foutrelis@archlinux.org>
  '8FC15A064950A99DD1BD14DD39E4B877E62EB915' # Sven-Hendrik Haase <svenstaro@archlinux.org>
  'A2FF3A36AAA56654109064AB19802F8B0D70FC30' # Jan Alexander Steffens (heftig) <heftig@archlinux.org>
  'B81B051F2D7FC867AAFF35A58DBD63B82072D77A' # SÃ©bastien Luttringer <seblu@archlinux.org>
  '6645B0A8C7005E78DB1D7864F99FFE0FEAE999BD' # Allan McRae (Developer) <allan@archlinux.org>
  'E240B57E2C4630BA768E2F26FC1B547C8D8172C8' # Levente Polyak <anthraxx@archlinux.org>
)
sha256sums=('6399d1adc7aa3227fd4fde01e269a16fd4741259dd82ca310aebd26330c59410'
            'c1112e0d13695a0d202316eeebec6767e30c147bb4d0fe70e1870dde2780ffaa'
            '00b0f6f71beb6303f0d5440b069e0d12e75fbc3d2c4ce6dfff819900dcf4a98e'
            '417e7362b4ed4b294878d82166721fb32e2b81d2c36c7e82fb85c624b795fe1b'
            '4137e590f424c575115855abec230c70b3dd39c70f49429721c98f2939582b27'
            '7478df8a1f79656fce91d8384892f7b6e39b966545b0db27372e0d4afa5a3b3f'
            'b1b5556e6c2a15b7a4a894afa05939dc108fe4690329c85c1b17c822f86951d1'
            '76420ce85d31345932ff647b40826e3483e6566aa8aab78b9a91b5b0a5d04cf9'
            '3754920226a691af046ab8d60005eb88316673c6759d277f6bd8f07a96f11396'
            '56aa882e4b067fc6a0ec7963f52b9e13dec94d08bc47807908034ea2e7a2d062'
            'dc949142cdfe3b966871a7bc61bc80971710540c7d80a476adb209d871849ba4'
            'cd8a4a4a4d3a26f834bf94571e472cbb9f895308014448824e16291b1daf9d75'
            '2a0b723731f2a599601004a19bab948a93a2921b0872f075dea78da73ac2b07d'
            '561b69478a20ef28c78744611f65a579abb0d8b998ac963879acae0a58111951')
b2sums=('074e7b619fc2840ec7b7fa4ee1c02831c7a7d9e206ab17f19463eaece80929dcf62c329a8fe8404c904b4e24e306fd691e40fa38795e3f31e0d3db9d674f675c'
        '3efeb77e1d9547d3f9f0fd71842b906827cc8ce5ecd4a5699e8c78ea8911cfc04a3ac3af857353f1d60c9970333294b1a409660efc6192185a53908b59f934e4'
        'ecfdd274888bee746058ce4ea350941730dd2eae79b5a16544374dbe2a69613a2c810bcee31bc5c1d4b9eb70208d147256f2ed10fa29a1b504a181938382d115'
        '336dee46f6da4f2c769b7a4d7bcb57799ebb8e1993d77e8dbdc8e324deefe7e4f807c4769fb1884bf2cfe1f7666af95efda1745c5a05def2fde8e9ab04c86c8c'
        'e8fb9ed7fb339a999a4252b6c362194954581a4a3761994d7cf96b2c3988ffc4a7d00e511e2dd043595fe19d0bc5b7791e0a59552a133c2182097edde970f6f9'
        '2a499e923d675f89df242679efa692cee0eeaa7bd49d3b74afa6d5a45d6d74620defb058e2cac1b7c19c373499a9b8a64fbe01df92a79a8182d8852f11d7e508'
        '5a700819c0d37248d310c0f36869c409880d3c46a1b21b8e820891d22e0424c13a759e50340d58526cbc342a5e82415888188259aaf0b7dce6b996de19455109'
        '447e8681c9ad3d5b357569d3d5a8da590b55146c2cafc6793edcff0852e0a43e6e5d627995039a95d883a9382c05601d594ff65d4188346a014f70d1258b4006'
        'c43a50f0870762a80da15aadb46b80a9305e149b94c8a6635cace648f598035bafdc6523de13374de11dfd97e8e0a3caae2f626f4ee98418b0dbf03f59ef050c'
        '8a5d74c4b9dcd528f2057b0675b526daa7ce92035441323ad87466bb0f2a1cf7de1e072588675923855f26b11c405bb9f7515121af02da9c3c319a990b4bb4cc'
        'b5b35387b979ee09410edf413194e74cbd81c9c5f54297e28f207333abad2ea4a80ab18f5cc6c9f66f743c60638215d7bf1692586ed1d1dd9ea15199e4d1f586'
        '02e4a20d25bf5ff53374803a8d60d996fa53be5010da576b2e79442cf82b8ae7bcd3ff02623f83fe031ffd09d5dcdbf78fa978a0410c87f2c21d2a3414d76ab8'
        'e0b43135d1bc8c97a107e70cb1a212afc5e855d54f917664ff241a1472f3add9ffbd0dc8ebae229652fd02e58d248fb4cf09dd53ad42e407f5ec1b4e8b644a3e'
        '1a869b4c7e0e0b9e74b49849ca647df1907c19b42d85c64f692fdf7d970e2716cbe2f6cf89af59c633aa0e0659346ed1dd65fa811a19cd3eeec934755b650dc3')

prepare() {
  cd "${_pkgname}-v${pkgver}"
  for src in "${source[@]}"; do
    src="${src%%::*}"
    src="${src##*/}"
    [[ $src = 0*.patch ]] || continue
    echo "Applying patch $src..."
    patch -Np1 < "../$src"
  done
}

build() {
  cd ${_pkgname}-v${pkgver}
  make BUILDTOOLVER="${pkgver}-${pkgrel}-${arch}" PREFIX=/usr
}

package() {
  cd ${_pkgname}-v${pkgver}
  make PREFIX=/usr DESTDIR="${pkgdir}" install
}

# vim: ts=2 sw=2 et:
