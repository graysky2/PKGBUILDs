From 9113a141a6a32fb55902d7c9297b9682eb54f807 Mon Sep 17 00:00:00 2001
From: graysky <graysky@archlinux.us>
Date: Tue, 25 May 2021 15:10:22 -0400
Subject: [PATCH 3/9] makechrootpkg: distcc

---
 makechrootpkg.in | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/makechrootpkg.in b/makechrootpkg.in
index 4748ac0..200cd00 100644
--- a/makechrootpkg.in
+++ b/makechrootpkg.in
@@ -214,7 +214,9 @@ _chrootbuild() {
 	# use "$" in arguments to commands with "sudo -i".  ${foo} or
 	# ${1} is OK, but $foo or $1 isn't.
 	# https://bugzilla.sudo.ws/show_bug.cgi?id=765
-	sudo --preserve-env=SOURCE_DATE_EPOCH -iu builduser bash -c 'cd /startdir; makepkg "$@"' -bash "$@"
+	mkdir /build/.distcc
+	chown builduser /build/.distcc
+	sudo --preserve-env=SOURCE_DATE_EPOCH -iu builduser DISTCC_IO_TIMEOUT=1200 DISTCC_DIR='/build/.distcc' bash -c 'cd /startdir; makepkg "$@"' -bash "$@"
 	ret=$?
 	case $ret in
 		0|14)
-- 
2.32.0

