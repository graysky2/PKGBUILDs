# Maintainer: Levente Polyak <anthraxx[at]archlinux[dot]org>
# Maintainer: Pierre Schmitz <pierre@archlinux.de>

# ALARM: Kevin Mihelich <kevin@archlinuxarm.org>
#  - patches to fix issues with how we use the tools

pkgname=devtools-alarm
_pkgname=devtools
pkgver=20230105
pkgrel=1
pkgdesc='Tools for Arch Linux ARM package maintainers graysky mods'
arch=('any')
license=('GPL')
url='https://gitlab.archlinux.org/archlinux/devtools'
conflicts=('devtools')
provides=('devtools')
depends=('bash' 'openssh' 'subversion' 'rsync' 'arch-install-scripts'
         'git' 'bzr' 'mercurial' 'diffutils' 'util-linux' 'awk')
makedepends=('asciidoc')
optdepends=('btrfs-progs: btrfs support')
source=(${url}/uploads/f0e6fd93923fd7b81f1574081d722c39/devtools-${pkgver}.tar.gz
  ${url}/uploads/7153224a91ad9785b4209f8426e260a4/devtools-${pkgver}.tar.gz.sig
  0001-makechrootpkg-cache-dir.patch
  0002-arch-nspawn-keep-mirrorlist.patch
  0003-makechrootpkg-distcc.patch
  0004-arch-nspawn-arm-fix.patch
  0005-makechrootpkg-no-default-logging.patch
  0006-archbuild-no-setarch.patch
  0007-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACKAGER.patch
  0008-makechrootpkg-gotmpdir.patch
  0009-arm-helpers.patch
  0010-Revert-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACK.patch
  0011-makechrootpkg-don-t-delete-PACKAGER-and-fix-MAKEFLAG.patch
  0012-Revert-makechrootpkg-no-default-logging.patch
)
validpgpkeys=(
  '4AA4767BBC9C4B1D18AE28B77F2D434B9741E8AC' # Pierre Schmitz <pierre@archlinux.org>
  '86CFFCA918CF3AF47147588051E8B148A9999C34' # Evangelos Foutras <foutrelis@archlinux.org>
  '8FC15A064950A99DD1BD14DD39E4B877E62EB915' # Sven-Hendrik Haase <svenstaro@archlinux.org>
  'A2FF3A36AAA56654109064AB19802F8B0D70FC30' # Jan Alexander Steffens (heftig) <heftig@archlinux.org>
  'B81B051F2D7FC867AAFF35A58DBD63B82072D77A' # SÃ©bastien Luttringer <seblu@archlinux.org>
  '6645B0A8C7005E78DB1D7864F99FFE0FEAE999BD' # Allan McRae (Developer) <allan@archlinux.org>
  'E240B57E2C4630BA768E2F26FC1B547C8D8172C8' # Levente Polyak <anthraxx@archlinux.org>
)
sha256sums=('8ade36f4102ef73b9e4db0b6d7a2a8111583ce3a6f990dfbef061c050af5ef4a'
            'SKIP'
            'f78d0e464c92cf555462807fea5cbd163b29bbf773319e68d65f0a9e73091e3f'
            '68525b1723fd9dc1e092ef37a19dfb2341682c5bb72cac4c9b14dcbe486aa3d8'
            'a251ef61096f6ee7ff132677ef24e898251a7933d0e5565591995158bc7b81a1'
            'dae31a8361c1e9b3d760d2c07801acaa774c4127eefc7b0db1d970eea0a80989'
            '81cdc9d6cb4b51151bd5b0cf9b3cdb7a283abe0340358cd1b12e65d29ad17a74'
            'a9cee974f426cad3553cde8d895d3d61f524fdeb4c238e6b82d550201ec2bede'
            'abe38f1eb6cb28f9f85f3af0a58b2651b73f504f879de145c3d34f2bb4d525ff'
            '77774f43f6d5025a996b0f35d39f103a5de5b26c213c90c62e554d3304f3a5e2'
            'b1faec36eaa7fbfd16b7e3790a0ec73934ce2e7ff65887f34fe5f35a975cb20c'
            'b5ac9f0cc0a757d97d9011e7d95242fdb87dc792cde3fbb3e5c263b97bdec7e3'
            'b4777d3366ccfa1d949487f2a4608c894bc306e8be0e3b93faf2791087e6a250'
            '86fec142261204b8c0ae7fa35c456edcdf289ba751cf1d415209d2e3ce8f746c')
b2sums=('448f44882617794ffb26a146fa92e2b2649d25791751d9b9c5d6872880d0889a02c95d0761979b5afdda9d05bb43d38509d13d8a99c8426def470ffe12e05d8d'
        'SKIP'
        '9312e2e9cf2a7e11063ad85f421f5fc5b3ed836ab544f8a910b0de6863a24a38681a051791dfa337f679faa8060146568cf37274ecd6d0e3149ff4cff1990c5a'
        '4c4bfa76817301dfdd77b4a87921cce4ae9025e1a54edf21fe550f60d0c2c6108c6bc6470003cd48c657244b7ef604c6a92edf200e8d420e3f3a2993c02cb032'
        'c26a8f9218bf8c2fb502eb637df9998b1957abe5268fb71d9fdb7f889a22c64889e3e5b823209049b4db584ffcade52533121aa45a23759cb5c37be30756649f'
        '6db458ceda4b620141000d414cfa60682bedff379ab00750f925d0fb0010b8aacbdd6de9cfcd16cb4cb7dcf64affed85a3afdd306160ea4a69586e3004582abc'
        '87f1d3e79ce31b023ec5d2cf25436120b8ba55a67e1b719123b2c0d4120d358f9a48cabffa13c085275d90220e4fbd2e6e6cd456bf92a44994dbab8d5a2184db'
        '3bd0dbcdff2db2bc216a8c50a45af42bbb34f7dc1be28b91f9de296b1b8cb03efd954d6b5611aba3612917696573d8a2c22e2a12851655adeff64d7a7774274b'
        '14405c09fc8e335ca7314faf2158bb887aea6ea2d8d7d2362fc3b408307edb6354741afdb5fe04fc07a0b25aa84432d7f844d3c7e16b893d060618bdd281d84e'
        '6652d1550ab9f786f552c471f02d17ba7372f15eb144cba8f84c0ef84629c7791f333f4b9e89e89631df66fb0c77d42d106f95c731106000eac28993268bb9d1'
        '7649acda1282f143f5ba72b2e76376ab3677835c9f9c43260bb02dc5676df7752a57e4db4f17d621012d508a32c274a563ef445ea70d6d5f25b4c9fc64835a07'
        '8da922d06c7d950ef1115878c9a79bd6176647ac96cefc658d8d440d4a7b7512657476df235d7939cbf3c1b66a6a79f774dd89d9d3e0fa5a4bc86bf3f2bbbbe0'
        '6a99fdd39dbece2e7310d69a4d344f09440ffdd363b25c4b90d8c76ef812656a3c180b30aaf052bb6d78aa19fa5f1ba30792be511827d08b53f90816a22cf78f'
        'ed32c5a6642e9013bf37f1ea74052b9045969c0c434e7a59bb17193996f36461732cb135e2a2f366ef95ca645a99ca0d2048dc0f8f0c4eb72054e8f37b9d4752')

prepare() {
  cd "${_pkgname}-${pkgver}"
  for src in "${source[@]}"; do
    src="${src%%::*}"
    src="${src##*/}"
    [[ $src = 0*.patch ]] || continue
    echo "Applying patch $src..."
    patch -Np1 < "../$src"
  done
}

build() {
  cd ${_pkgname}-${pkgver}
  make BUILDTOOLVER="${pkgver}-${pkgrel}-${arch}" PREFIX=/usr
}

package() {
  cd ${_pkgname}-${pkgver}
  make PREFIX=/usr DESTDIR="${pkgdir}" install
}

# vim: ts=2 sw=2 et:
