From f3a61c3692c77f7c69cd5653d32a1960392226d0 Mon Sep 17 00:00:00 2001
From: graysky <therealgraysky@proton.me>
Date: Sat, 20 Aug 2022 16:40:01 -0400
Subject: [PATCH 10/10] makechrootpkg: don't delete PACKAGER and fix MAKEFLAGS

Keep MAKEFLAGS so it can prefix a call to makechrootpkg.
MAKEFLAGS= must not be defined in $BUILDROOT/etc/makepkg.conf for this to work.
See: https://bugs.archlinux.org/task/64938
---
 makechrootpkg.in | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/makechrootpkg.in b/makechrootpkg.in
index 4c1da15..c16b7c2 100644
--- a/makechrootpkg.in
+++ b/makechrootpkg.in
@@ -164,9 +164,8 @@ prepare_chroot() {
 
 	$install -d "$copydir"/{build,startdir,{pkg,srcpkg,src,log}dest}
 
-	sed -e '/^MAKEFLAGS=/d' -e '/^PACKAGER=/d' -i "$copydir/etc/makepkg.conf"
 	for x in BUILDDIR=/build PKGDEST=/pkgdest SRCPKGDEST=/srcpkgdest SRCDEST=/srcdest LOGDEST=/logdest \
-		"MAKEFLAGS='${MAKEFLAGS:-}'" "PACKAGER='${PACKAGER:-}'"
+		"MAKEFLAGS='${MAKEFLAGS:-}'"
 	do
 		grep -q "^$x" "$copydir/etc/makepkg.conf" && continue
 		echo "$x" >>"$copydir/etc/makepkg.conf"
-- 
2.37.2

