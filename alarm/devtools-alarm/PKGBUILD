# Maintainer: Levente Polyak <anthraxx[at]archlinux[dot]org>
# Maintainer: Pierre Schmitz <pierre@archlinux.de>

# ALARM: Kevin Mihelich <kevin@archlinuxarm.org>
#  - patches to fix issues with how we use the tools

pkgname=devtools-alarm
_pkgname=devtools
pkgver=1.1.1
pkgrel=1
pkgdesc='Tools for Arch Linux ARM package maintainers graysky mods'
arch=('any')
license=('GPL')
url='https://gitlab.archlinux.org/archlinux/devtools'
conflicts=('devtools')
provides=('devtools')
depends=('bash' 'openssh' 'subversion' 'rsync' 'arch-install-scripts'
         'git' 'bzr' 'mercurial' 'diffutils' 'util-linux' 'awk')
makedepends=('asciidoc')
optdepends=('btrfs-progs: btrfs support')
source=(https://gitlab.archlinux.org/archlinux/$_pkgname/-/archive/v$pkgver/$_pkgname-v$pkgver.tar.gz
#  https://gitlab.archlinux.org/archlinux/$_pkgname/-/archive/v$pkgver/$_pkgname-v$pkgver.tar.gz.sig
  0001-makechrootpkg-cache-dir.patch
  0002-arch-nspawn-keep-mirrorlist.patch
  0003-makechrootpkg-distcc.patch
  0004-arch-nspawn-arm-fix.patch
  0005-makechrootpkg-no-default-logging.patch
  0006-archbuild-no-setarch.patch
  0007-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACKAGER.patch
  0008-makechrootpkg-gotmpdir.patch
  0009-arm-helpers.patch
  0010-Revert-makechrootpkg-don-t-delete-MAKEFLAGS-and-PACK.patch
  0011-makechrootpkg-don-t-delete-PACKAGER-and-fix-MAKEFLAG.patch
  0012-Revert-makechrootpkg-no-default-logging.patch
  0013-arch-nspawn-fix-setarch-for-armv7h.patch
)
validpgpkeys=(
  '4AA4767BBC9C4B1D18AE28B77F2D434B9741E8AC' # Pierre Schmitz <pierre@archlinux.org>
  '86CFFCA918CF3AF47147588051E8B148A9999C34' # Evangelos Foutras <foutrelis@archlinux.org>
  '8FC15A064950A99DD1BD14DD39E4B877E62EB915' # Sven-Hendrik Haase <svenstaro@archlinux.org>
  'A2FF3A36AAA56654109064AB19802F8B0D70FC30' # Jan Alexander Steffens (heftig) <heftig@archlinux.org>
  'B81B051F2D7FC867AAFF35A58DBD63B82072D77A' # SÃ©bastien Luttringer <seblu@archlinux.org>
  '6645B0A8C7005E78DB1D7864F99FFE0FEAE999BD' # Allan McRae (Developer) <allan@archlinux.org>
  'E240B57E2C4630BA768E2F26FC1B547C8D8172C8' # Levente Polyak <anthraxx@archlinux.org>
)
sha256sums=('3a53412596577c55a3de26d87fd018e837f1f761feb1c00dcd2085342c25b181'
            '6acbc60c86cbe4850537d3e93b874dcd901ac5c466cadfd8a23ec702765f68d2'
            '4d4559d0507c20a0473b36bb26eb762de10a1f941f958697b98cd07c77f8d930'
            '47fc4e66b9d7e05a0be6ac6fe5449a2694f3832618811aadc6251c8d128b60c4'
            '4e5000614d39d57a6bb6a8fe1fae65c8bdb1de376b848415e5cd9427c5546d09'
            '9ce7b8f17e59265c58abe2fe4a54ca01dcaf47444bc6e5146f0e84f8bca0ef45'
            '8e757ecd8da44aed085f5ec6c055537a81f8827befab63a93c67c8df6c384d26'
            '10d3c0490f35db272c0a231f6efc2b5dd3f913e8f103302bce7e1f4204219894'
            'ba4d4492bb59bd4f765d2827cce8a5e3f059ed85a5253b2f888c6a8ad6a05ab5'
            '050f2100a19a69e394d2cccbb8f158dbadd85e47992c98fa561a1b093287ae22'
            '1e80670f2c1823c12fdbd81f352cec2cd8a180586beaffb494448ca3cf62b3f0'
            '75abd3d9c3bd3376837e6f91a96da54eedada0ed296e200f2c26bc40c9da4b21'
            '498f9ef1f1aa4ea49d3965b947165f583327b7c29096c95aa53dd2b8206de19d'
            '0036aa3408c7cca272dd1f443d017c3bc7c08bd09499a72e31ccfc23ea4300b7')
b2sums=('56a72e4233528bdb4c87f25bac8572690e0099a26f733b0ab5efd3b2b312ced0e7b29e856573a063c6b5e3ef1fdcdca35ed7bc2b6d990f2284541c58e8b4d22b'
        'daa4e55c3af703c82d1d5c9cfab48f86a359f14a69e8a926419117831d19dc25c47bda8af992b9ae309540427beb29cedda3cdb9f7bd2b748c8a0f09d8298750'
        '9f7334f2969451ee1646ac0b39d2ff36ff6e897876be71155b350e4bbc41410331e72902a7014253ffffbc4380699610ec7237ab48cfd667793d98bc74b8b6ef'
        'dff1aa590a40fc902acb4a2adc9e8fe59b6edc41304944f60e134d5822a1dc9de8f87988a86628636abee2b059d381ecaf64c8c9fca0789b0ab654deba232c0a'
        'ab3ab2d3d3208a1e381a6ed9cf77aa7da9ceded01f4492cf9e1e8ee53c7cb189972ad69689d5e56a0722ef1c9215c0a158c2e4104445641e906d108fceccbab7'
        'ebede30c866f0f5afcfb46ae3a9a4669e6ee2990fc72747fa767a1b0b25ce4f14f0edf3ab534aa143f18bcf72a8fce702990b85012c9398906fef103ce0a3009'
        'cef9fed5334d7291b8e1990f03be2c1b311a81d7117f6fab9fca7498ce84c8a778c329c9928cb4d1fbcc6ad48f4a84bd8158b37d7337366503d4518a7993cf30'
        'c532b68afbc799d7df9465f040264447d834cc6ac669b733049ed3c0998102ceba43648716fde93fcd51679b8b9a6935c49d824035120a3c812061b61a368a52'
        '2c942e62c41a266bdcbaeb3dbf25dde9b585710b95a2b3611766d8fadd6c26fb689d6fe774a665c1c11c8e4cb36a365206e642bb30b43d389ff69ae0b7639b99'
        '28063cb46af6d8bd2f21dec2dbe6c832df4ec85cf623edc961635bfcfd315e13a51559a2bd18d103f9f024db8191ece82b7dfdfe5278e4d7ee6f6f2b6181d8c4'
        'eab94f68d90d4b3fa90364ded7b6730d292d2989198c6a81fb75f03b31cd27349640f45bbc5731225c1e016dd26164e718c03ba5a9e0e5aad50f0ab89306beae'
        '376bd2b4a301a2b51b7d3bbab0e641113aeed501bc1f0c1e4892d61723587d26a138a065b40e8a3409806389dcaf04d2e6677eb59aa670a9dd5b4581f095e53a'
        '9de2e7e3fd11059758787b2cdd48d6cced7bc7c5e9962373106faaec42e479f4fdc13c5551b7253ef9397b40df718b0069ce728db0ca1b8ebfd246b15d486d3d'
        'd0b52554235319859d473bed550d6d30073db23459314dda177ec806c7cf08e6215df55a0feaba76f11824ea0a1ba63feda31028b493880dc1dd791e1820578b')

prepare() {
  cd "${_pkgname}-v${pkgver}"
  for src in "${source[@]}"; do
    src="${src%%::*}"
    src="${src##*/}"
    [[ $src = 0*.patch ]] || continue
    echo "Applying patch $src..."
    patch -Np1 < "../$src"
  done
}

build() {
  cd ${_pkgname}-v${pkgver}
  make BUILDTOOLVER="${pkgver}-${pkgrel}-${arch}" PREFIX=/usr
}

package() {
  cd ${_pkgname}-v${pkgver}
  make PREFIX=/usr DESTDIR="${pkgdir}" install
}

# vim: ts=2 sw=2 et:
